<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="UA-25393690-2">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="">
<meta name="keywords" content="java, svqjug, java8, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Java 8 MOOC - Session 2 Summary : trishagee.github.io"/>
<meta property="og:site_name" content="Trisha Gee"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://trishagee.github.io/post/java_8_mooc_session2/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2015-07-31"/>
<meta property="article:modified_time" content="2015-07-31"/>

<meta property="article:tag" content="java">
<meta property="article:tag" content="svqjug">
<meta property="article:tag" content="java8">



<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@trisha_gee">
<meta name="twitter:title" content="Java 8 MOOC - Session 2 Summary : trishagee.github.io">
<meta name="twitter:creator" content="@trishagee">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="trishagee.github.io">



    <base href="http://trishagee.github.io/">
    <title> Java 8 MOOC - Session 2 Summary - trishagee.github.io </title>
    <link rel="canonical" href="http://trishagee.github.io/post/java_8_mooc_session2/">
    

    <link href='http://fonts.googleapis.com/css?family=Fjalla+One|Open+Sans:300' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
    <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
    <div id="byline">by Trisha Gee</div>
    <nav id="nav">
        <ul id="mainnav">
    <li>
        <a href="/post/">
            <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
            <span> blog </span>
        </a>
    </li>
    <li>
        <a href="/project/">
            <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
            <span> code </span>
        </a>
    </li>
    <li>
        <a href="/presentation/">
            <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
            <span> talks </span>
        </a>
    </li>
    <li>
        <a href="/resources/">
            <span class="icon"> <i aria-hidden="true" class="icon-gears"></i></span>
            <span> resources </span>
        </a>
    </li>
</ul>

        <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>

        <div class="dropdown share">
            <ul class="social">
                <li><a href="https://twitter.com/intent/tweet?status=Java%208%20MOOC%20-%20Session%202%20Summary-http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank"
                       title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank" title="Join me on Facebook"
                       class="facebook"><span class="icon icon-facebook"></span>Facebook</a></li>
                <li><a href="https://plus.google.com/share?url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank" title="Google+" class="googleplus"><span
                        class="icon icon-google-plus"></span>Google+</a></li>
                <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f&title=Java%208%20MOOC%20-%20Session%202%20Summary&source=spf13"
                       target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a></li>
                <li><a href="http://del.icio.us/post?url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank" title="Delicious" class="delicious"><span
                        class="icon icon-delicious"></span>Delicious</a></li>
                <li><a href="http://www.reddit.com/submit?url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank" title="Reddit" class="reddit"><span
                        class="icon icon-reddit"></span>Reddit</a></li>
                <li><a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f" target="_blank" title="StumbleUpon"
                       class="stumbleupon"><span class="icon icon-stumbleupon"></span>StumbleUpon</a></li>
                <li><a href="http://www.dzone.com/links/add.html?url=http%3a%2f%2ftrishagee.github.io%2fpost%2fjava_8_mooc_session2%2f&title=Java%208%20MOOC%20-%20Session%202%20Summary" target="_blank" title="DZone"
                       class="dzone"><span class="icon icon-dzone"></span>DZone</a></li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>

        <div class="dropdown follow">
            <ul class="social">
                <li><a href="http://trishagee.github.io/index.xml" target="_blank" title="Subscribe by RSS" class="rss"><span
                        class="icon icon-feed-2"></span>RSS</a></li>
                <li><a href="http://www.twitter.com/trisha_gee" target="_blank" title="Follow me on Twitter" class="twitter"><span
                        class="icon icon-twitter"></span>Twitter</a></li>
                <li><a href="http://www.linkedin.com/in/trishagee" target="_blank" title="LinkedIn" class="linkedin"><span class="
                        icon icon-linkedin"></span>LinkedIn</a></li>
                <li><a href="http://github.com/trishagee" target="_blank" title="GitHub" class="github"><span class="
                        icon icon-github"></span>GitHub</a></li>
                <li><a href="http://www.slideshare.net/trishagee" target="_blank" title="SlideShare" class="slideshare"><span
                        class="icon icon-slideshare"></span>SlideShare</a></li>
                <li><a href="https://plus.google.com/+TrishaGee/" target="_blank" title="Google+" class="googleplus"><span
                        class="icon icon-google-plus"></span>Google+</a></li>
            </ul>
            <span class="subcount"></span>
        </div>
    </li>
</ul>

    </nav>
</header>



<section id="main">
  <h1 itemprop="name" id="title">Java 8 MOOC - Session 2 Summary</h1>
  <div>
        <article itemprop="articleBody" id="content">
           <p>As I mentioned <a href="/post/java_8_mooc_session1">last week</a>, the <a href="http://www.meetup.com/SVQJUG/">Sevilla Java User Group</a>
is working towards completing the
<a href="https://apexapps.oracle.com/pls/apex/f?p=44785:145:0::::P145_EVENT_ID,P145_PREV_PAGE:4887,143">Java 8 MOOC</a> on
lambdas and streams. We&rsquo;re running <a href="http://www.meetup.com/SVQJUG/events/223677436/">three sessions</a>
to share knowledge between people who are doing the course.</p>

<p>The second week&rsquo;s lesson was about
<a href="http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">Streams</a> - how you can use the
new stream API to transform data. There was also a whole section on
<a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html">Optional</a>, which initially seemed like
rather a lot, but it turns out that <code>Optional</code> can do rather more than I originally thought.</p>

<p>In the meetup session, we talked about:<br />
<strong><a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html">Optional</a></strong>: we were pretty
comfortable,
I think, with using <code>Optional</code> to
prevent a <code>NullPointerException</code>. What we weren&rsquo;t so clear on were the examples of
<code>filter()</code> and <code>map()</code> - if you were getting your <code>Optional</code> values from a stream, why wouldn&rsquo;t you do the map and the
filter on the stream first? For example, why do this:</p>

<pre><code>list.stream()
    .findFirst()
    .map(String::trim)
    .filter(s -&gt; s.length() &gt; 0)
    .ifPresent(System.out::println);
</code></pre>

<p>when you could map and filter in the stream to get the first non-empty value? That certainly seems like an
interesting question in relation to streams.</p>

<p>I can see <code>Optional</code> being more useful when other APIs fully
support Java 8 and return <code>Optional</code> values, then you can perform additional operations on return values.</p>

<p><strong>That terminal operation&rsquo;s not actually terminal??</strong>: We ran into this a couple of times in our examples in the
session, one example is the code above (let&rsquo;s copy it down here so we can look at it more closely):</p>

<pre><code>list.stream()
    .findFirst()
    .map(String::trim)
    .filter(s1 -&gt; s1.length() &gt; 0)
    .ifPresent(System.out::println);
</code></pre>

<p>Isn&rsquo;t <code>findFirst()</code> a
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#StreamOps">terminal operation</a>? How
can you carry on doing more operations on that?</p>

<p>The answer is, of course, that the return type of the terminal operation can also lead to further operations.  The
above is actually:</p>

<pre><code>Optional&lt;String&gt; result = list.stream()
                              .findFirst();
result.map(String::trim)
      .filter(s1 -&gt; s1.length() &gt; 0)
      .ifPresent(System.out::println);
</code></pre>

<p>Our terminal operation returns an optional, which allows you to do further operations. Another example of this
confusion:</p>

<pre><code>list.stream()
    .map(String::toLowerCase)
    .collect(toList())
    .forEach(System.out::println);
</code></pre>

<p>Here, <code>collect()</code> is a terminal operation, but it returns a list, which also allows <code>forEach()</code>:</p>

<pre><code>List&lt;String&gt; results = list.stream()
                           .map(String::toLowerCase)
                           .collect(toList());
results.forEach(System.out::println);
</code></pre>

<p>So be aware that just because it&rsquo;s called a terminal operation, doesn&rsquo;t mean you can&rsquo;t perform other operations on
the returned value.</p>

<p><strong>Parallel/sequential/parallel</strong>: there had been a question in the previous week about why you could write code like
this:</p>

<pre><code>list.stream()
    .parallel()
    .map(String::trim)
    .sequential()
    .filter(s1 -&gt; s1.length() &gt; 0)
    .parallel()
    .forEach(System.out::println);
</code></pre>

<p>and whether that would let you dictate which sections of the stream were parallel and which were to be processed in
serial.  Lesson two set the lesson straight, declaring &ldquo;the last operator wins&rdquo; - meaning <em>all</em> of the above code will
be run as a parallel stream. I can&rsquo;t find any documentation for this, I&rsquo;ll edit this post if I locate it.</p>

<p><strong><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/BaseStream.html#unordered--">Unordered</a></strong>: &ldquo;Why
would you ever want your stream to be unordered?&rdquo; - the answer is that <code>unordered()</code> <a href="http://stackoverflow.com/a/21350234/653519">doesn&rsquo;t turn
your sorted collection into one with no order</a>, it just says that when
this code is executed, the order of elements doesn&rsquo;t matter.  This might make processing faster on a parallel stream,
but as a group we figured it would probably be pointless on a sequential stream.</p>

<p><strong>Efficiency optimisations and order of stream operations</strong>: We had a <em>long</em> conversation about the order in which you
perform
operations in a stream. The MOOC (in fact, most documentation around Streams) tells us that a) streams are
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html">lazy</a>, and
not evaluated until a terminal operator is encountered and b) this enables optimisation of the operations in the
stream.  That lead to a discussion about the following code:</p>

<pre><code>list.stream()
    .map(String::toLowerCase)
    .filter(s -&gt; s.length() % 2 == 1)
    .collect(toList());
</code></pre>

<p>The filter operation should result in less items to process in the stream. Given that the <code>map()</code> operation doesn&rsquo;t
change anything that <code>filter()</code> relies on, will this code be optimised somehow under the covers so that the filter
is actually executed first? Or are optimisations still going to respect the order of operations on a stream?</p>

<p>Our case is actually a very specific case, because a) the <code>map()</code> returns the same type as the params passed in (i.e.
it doesn&rsquo;t map a <code>String</code> to an <code>int</code>) and b) the <code>map()</code> doesn&rsquo;t change the characteristic the <code>filter()</code> is
looking at (i.e. length). But generally speaking, you can&rsquo;t expect these conditions to be true - in fact I bet in a
large number of cases they are <em>not</em> true. So pipeline operations are <a href="http://stackoverflow.com/a/22056258/653519">performed in the order in which they are
written</a>, meaning that our <code>map</code> and <code>filter</code> will not be re-ordered into
a more efficient order.</p>

<p>A good rule of thumb seems to be to do filtering as early in the stream as possible - that way you can potentially
cut down the number of items you process in each step of the stream. Therefore our code would probably be better as:</p>

<pre><code>list.stream()
    .filter(s -&gt; s.length() % 2 == 1)
    .map(String::toLowerCase)
    .collect(toList());
</code></pre>

<p><br/>
<strong>Flat Map</strong>: what&hellip;?
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#flatMap-java.util.function.Function-"><code>flatMap()</code></a>
is one of those methods that makes total sense once you get the hang of it, and you don&rsquo;t
understand why it was so confusing. But the first time you encounter it, it&rsquo;s confusing - how is <code>flatMap()</code>
different to <code>map()</code>?</p>

<p>Well, <code>flatMap</code> is used to squish (for example) a stream of streams into just a simple stream. It&rsquo;s like turning a
2-dimensional array into a single dimension so that you can iterate over all the items without needing nested
for-loops. There&rsquo;s <a href="http://stackoverflow.com/a/22384132/653519">an example on StackOverflow</a>, and some more examples
in answer to <a href="http://stackoverflow.com/questions/26684562/java-8-map-and-flatmap-methods">this question</a>.</p>

<p><strong>Comparators</strong>: We&rsquo;ve probably all written comparators at some point, it&rsquo;s probably one of those examples where we
really did use anonymous inner classes &ldquo;in the olden days&rdquo; and were looking forward to replacing them with lambdas.</p>

<pre><code>reader.lines()
      .sorted(new Comparator&lt;String&gt;() {
          @Override
          public int compare(String o1, String o2) {
              return ???;
          }
      })
      .collect(toList());
</code></pre>

<p>Sadly, using a lambda still doesn&rsquo;t answer the question &ldquo;do I minus o1 from o2, or o2 from o1?&rdquo;:</p>

<pre><code>reader.lines()
      .sorted((o1, o2) -&gt; ??? )
      .collect(toList());
</code></pre>

<p>But there&rsquo;s yet another new method in Java 8 here that can save us, one that is not nearly as well publicised as it
should be. There&rsquo;s a
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#comparing-java.util.function.Function-"><code>Comparator.comparing()</code></a>
that you can use to really easily define what to compare on. The JavaDoc and signature looks kinda confusing, but
this is one of those places where method references suddenly make loads of sense:</p>

<pre><code>reader.lines()
      .sorted(comparingInt(String::length))
      .collect(toList());
</code></pre>

<p>(Here we&rsquo;re actually using the <code>comparingInt</code> method as we&rsquo;re going to compare on a primitive value). Personally this
is one of my favourite new features in Java 8.</p>

<p><br/>
Join us next week for the <a href="http://www.meetup.com/SVQJUG/events/223910762/">last session on Java 8 - Lambdas and Streams</a>.</p>

        </article>
  </div>
</section>



<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Fri Jul 31, 2015 </h4>
        <h5 id="wc"> 1200 Words </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li><a href="http://trishagee.github.io//tags/java">java</a></li>
        
        <li><a href="http://trishagee.github.io//tags/svqjug">svqjug</a></li>
        
        <li><a href="http://trishagee.github.io//tags/java8">java8</a></li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;
    </section>
    <section id="next">
        &nbsp;<a class="next" href="http://trishagee.github.io/drafts/code_review_2/">CR <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author:</h4>
        Trisha is a Java Champion, a MongoDB Master, and a leader of the
        Sevilla Java User Group. She works for
        <a href="https://www.jetbrains.com/">JetBrains</a> who very kindly pay her
        to do what she loves. She believes we
        shouldn't all have to make the same mistakes again and again.
    </section>
</div>

</aside>

<meta itemprop="wordCount" content="1105">
<meta itemprop="datePublished" content="2015-07-31">
<meta itemprop="url" content="http://trishagee.github.io/post/java_8_mooc_session2/">


<aside id=comments>
    <div><h2> Comments </h2></div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'trishagee';
    var disqus_identifier = 'http:\/\/trishagee.github.io\/post\/java_8_mooc_session2\/';
    var disqus_title = 'Java 8 MOOC - Session 2';
    var disqus_url = 'http:\/\/trishagee.github.io\/post\/java_8_mooc_session2';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>

<footer>
    <div>
        <p>
            &copy; 2013-14 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Trisha Gee.</span></span>
            <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons Attribution">Some rights reserved</a>;
            please attribute properly and link back. <br>
            Powered by <a href="http://hugo.spf13.com">Hugo</a>.
            Original layout created by Steve Francia <a href="http://http://spf13.com/">http://spf13.com/</a>, derived from <a
                href="https://github.com/spf13/spf13.com">https://github.com/spf13/spf13.com</a>.
        </p>
    </div>
</footer>
<script type="text/javascript">

    var _gaq = _gaq || [];

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49006189-1', 'auto');
    ga('send', 'pageview');

    (function () {
        var j = function (a, b) {
            return window.getComputedStyle ? getComputedStyle(a).getPropertyValue(b) : a.currentStyle[b]
        };
        var k = function (a, b, c) {
            if (a.addEventListener)a.addEventListener(b, c, false); else a.attachEvent('on' + b, c)
        };
        var l = function (a, b) {
            for (key in b)if (b.hasOwnProperty(key))a[key] = b[key];
            return a
        };
        window.fitText = function (d, e, f) {
            var g = l({'minFontSize': -1 / 0, 'maxFontSize': 1 / 0}, f);
            var h = function (a) {
                var b = e || 1;
                var c = function () {
                    a.style.fontSize = Math.max(Math.min(a.clientWidth / (b * 10), parseFloat(g.maxFontSize)), parseFloat(g.minFontSize)) + 'px'
                };
                c();
                k(window, 'resize', c)
            };
            if (d.length)for (var i = 0; i < d.length; i++)h(d[i]); else h(d);
            return d
        }
    })();
    fitText(document.getElementById('title'), 1)

</script>
</body>
</html>

